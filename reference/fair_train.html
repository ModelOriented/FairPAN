<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Trains fairly the PAN model — fair_train • FairPAN</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Trains fairly the PAN model — fair_train" />
<meta property="og:description" content="Trains Predictive Adversarial Network model, which means that it proceeds
with the mutual training of adversarial model on whole dataloader and
classifier on a single mini batch. The result is a fairer classifier." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FairPAN</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Tutorial.html">FairPAN Tutorial</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Trains fairly the PAN model</h1>
    
    <div class="hidden name"><code>fair_train.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Trains Predictive Adversarial Network model, which means that it proceeds
with the mutual training of adversarial model on whole dataloader and
classifier on a single mini batch. The result is a fairer classifier.</p>
    </div>

    <pre class="usage"><span class='fu'>fair_train</span><span class='op'>(</span>
  <span class='va'>dsl</span>,
  <span class='va'>clf_model</span>,
  <span class='va'>adv_model</span>,
  <span class='va'>clf_optimizer</span>,
  <span class='va'>adv_optimizer</span>,
  <span class='va'>dev</span>,
  <span class='va'>sensitive_train</span>,
  <span class='va'>sensitive_test</span>,
  n_ep_pan <span class='op'>=</span> <span class='fl'>50</span>,
  batch_size <span class='op'>=</span> <span class='fl'>50</span>,
  learning_rate_adv <span class='op'>=</span> <span class='fl'>0.001</span>,
  learning_rate_clf <span class='op'>=</span> <span class='fl'>0.001</span>,
  lambda <span class='op'>=</span> <span class='fl'>130</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  monitor <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dsl</th>
      <td><p><code>dataset_loader</code> object for classificator network.</p></td>
    </tr>
    <tr>
      <th>clf_model</th>
      <td><p>net, nn_module, classifier model (preferably after pretrain).</p></td>
    </tr>
    <tr>
      <th>adv_model</th>
      <td><p>net, nn_module, adversarial model (preferably after pretrain).</p></td>
    </tr>
    <tr>
      <th>clf_optimizer</th>
      <td><p>optimizer for classificator model from pretrain.</p></td>
    </tr>
    <tr>
      <th>adv_optimizer</th>
      <td><p>optimizer for adversarial model from pretrain.</p></td>
    </tr>
    <tr>
      <th>dev</th>
      <td><p>device used for computation ("cuda" or "cpu").</p></td>
    </tr>
    <tr>
      <th>sensitive_train</th>
      <td><p>integer vector of sensitive attribute used for
adversarial models training.</p></td>
    </tr>
    <tr>
      <th>sensitive_test</th>
      <td><p>integer vector of sensitive attribute used for
adversarial models testing.</p></td>
    </tr>
    <tr>
      <th>n_ep_pan</th>
      <td><p>number of epochs for PAN training. Default: 50.</p></td>
    </tr>
    <tr>
      <th>batch_size</th>
      <td><p>batch size used in adversarial models <code>dataset_loader</code>
Default: 50.</p></td>
    </tr>
    <tr>
      <th>learning_rate_adv</th>
      <td><p>learning rate of adversarial. Default: 0.001.</p></td>
    </tr>
    <tr>
      <th>learning_rate_clf</th>
      <td><p>learning rate of classifier. Default: 0.001.</p></td>
    </tr>
    <tr>
      <th>lambda</th>
      <td><p>parameter regulating learning process (intuition: the bigger it
is, the fairer predictions and the worse accuracy of classifier).
Default: 130</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>logical indicating if we want to print monitored outputs or
not. Default: TRUE.</p></td>
    </tr>
    <tr>
      <th>monitor</th>
      <td><p>logical indicating if we want to monitor the learning process
or not (monitoring tends to slow down the training proccess, but provides
some useful info to adjust parameters and training process) Default: TRUE.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>NULL if monitor is FALSE, list of metrics if it is TRUE</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Trains Predictive Adversarial Network model. After the pretrain stage we
finally start proper fair training operation. We take all data from the
previous stage (models, optimizers and batch size) and engage the models
into a zero-sum-game where classifier starts to deceive adversarial and
in the end it ends with fair predictions. For a basic understanding of how
this process works it is advisable to read a vignette from this package. To
deeply understand this process you can read:
[Towards fairness in ML with adversarial networks, Stijn Tonk]
(https://godatadriven.com/blog/towards-fairness-in-ml-with-adversarial-networks/)</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='va'>dev</span> <span class='op'>&lt;-</span> <span class='st'>"cpu"</span>
<span class='co'># presaved torch models from pretrain phase</span>
<span class='va'>model1</span> <span class='op'>&lt;-</span> <span class='fu'>torch_load</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>,<span class='st'>"preclf"</span>,package<span class='op'>=</span><span class='st'>"FairPAN"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>model11</span> <span class='op'>&lt;-</span> <span class='fu'>torch_load</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>,<span class='st'>"preadv"</span>,package<span class='op'>=</span><span class='st'>"FairPAN"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># presaved optimizers dictionaries from pretrain phase</span>
<span class='va'>model1_optimizer_dict</span> <span class='op'>&lt;-</span> <span class='fu'>torch_load</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>,<span class='st'>"preclf_optimizer"</span>,package<span class='op'>=</span><span class='st'>"FairPAN"</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>model11_optimizer_dict</span> <span class='op'>&lt;-</span> <span class='fu'>torch_load</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>,<span class='st'>"preadv_optimizer"</span>,package<span class='op'>=</span><span class='st'>"FairPAN"</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'># Recreating optimizers</span>
<span class='va'>model1_optimizer</span> <span class='op'>&lt;-</span> <span class='fu'>optim_adam</span><span class='op'>(</span><span class='va'>model1</span><span class='op'>$</span><span class='va'>parameters</span>, lr <span class='op'>=</span> <span class='fl'>0.001</span><span class='op'>)</span>
<span class='va'>model11_optimizer</span> <span class='op'>&lt;-</span> <span class='fu'>optim_adam</span><span class='op'>(</span><span class='va'>model11</span><span class='op'>$</span><span class='va'>parameters</span>, lr <span class='op'>=</span> <span class='fl'>0.001</span><span class='op'>)</span>

<span class='co'># Loading saved optimizer state</span>
<span class='va'>model1_optimizer</span><span class='op'>$</span><span class='fu'>load_state_dict</span><span class='op'>(</span><span class='va'>model1_optimizer_dict</span><span class='op'>)</span>
<span class='va'>model11_optimizer</span><span class='op'>$</span><span class='fu'>load_state_dict</span><span class='op'>(</span><span class='va'>model11_optimizer_dict</span><span class='op'>)</span>

<span class='co'># presaved output of `preprocess` function</span>
<span class='va'>processed</span> <span class='op'>&lt;-</span> <span class='fu'>torch_load</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/system.file.html'>system.file</a></span><span class='op'>(</span><span class='st'>"extdata"</span>,<span class='st'>"processed"</span>,package<span class='op'>=</span><span class='st'>"FairPAN"</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>dsl</span> <span class='op'>&lt;-</span> <span class='fu'><a href='dataset_loader.html'>dataset_loader</a></span><span class='op'>(</span><span class='va'>processed</span><span class='op'>$</span><span class='va'>train_x</span>, <span class='va'>processed</span><span class='op'>$</span><span class='va'>train_y</span>, <span class='va'>processed</span><span class='op'>$</span><span class='va'>test_x</span>,
                      <span class='va'>processed</span><span class='op'>$</span><span class='va'>test_y</span>, batch_size<span class='op'>=</span><span class='fl'>5</span>, dev<span class='op'>=</span><span class='va'>dev</span><span class='op'>)</span>

<span class='fu'>fair_train</span><span class='op'>(</span>
  n_ep_pan <span class='op'>=</span> <span class='fl'>2</span>,
  dsl <span class='op'>=</span> <span class='va'>dsl</span>,
  clf_model <span class='op'>=</span> <span class='va'>model1</span>,
  adv_model <span class='op'>=</span> <span class='va'>model11</span>,
  clf_optimizer <span class='op'>=</span> <span class='va'>model1_optimizer</span>,
  adv_optimizer <span class='op'>=</span> <span class='va'>model11_optimizer</span>,
  dev <span class='op'>=</span> <span class='va'>dev</span>,
  sensitive_train <span class='op'>=</span> <span class='va'>processed</span><span class='op'>$</span><span class='va'>sensitive_train</span>,
  sensitive_test <span class='op'>=</span> <span class='va'>processed</span><span class='op'>$</span><span class='va'>sensitive_test</span>,
  batch_size <span class='op'>=</span> <span class='fl'>5</span>,
  learning_rate_adv <span class='op'>=</span> <span class='fl'>0.001</span>,
  learning_rate_clf <span class='op'>=</span> <span class='fl'>0.001</span>,
  lambda <span class='op'>=</span> <span class='fl'>130</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  monitor <span class='op'>=</span> <span class='cn'>TRUE</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; PAN epoch 1 
#&gt; Classifier at epoch 1:training loss: -75.339, accuracy: 0.838
#&gt; Adversary at epoch 1: training loss: 86.504,accuracy: 0.590, STPR: 0.319
#&gt; PAN epoch 2 
#&gt; Classifier at epoch 2:training loss: -95.961, accuracy: 0.838
#&gt; Adversary at epoch 2: training loss: 86.415,accuracy: 0.596, STPR: 0.296</div><div class='output co'>#&gt; $STP
#&gt; [1] 0.3192681 0.2964632
#&gt; 
#&gt; $adversary_acc
#&gt; [1] 0.5900000 0.5957143
#&gt; 
#&gt; $classifier_acc
#&gt; [1] 0.8381963 0.8381963
#&gt; 
#&gt; $adversary_losses
#&gt; [1] 86.50376 86.41489
#&gt; </div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Hubert Ruczyński, Jakub Wiśniewski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


